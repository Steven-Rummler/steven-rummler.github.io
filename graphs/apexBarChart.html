<html>

<head>
  <title>CanvasJS Bar Chart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>
  <div id="chartContainer" style="height: 100%; width: 100%;"></div>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script>
    window.onload = function () {
      const defaultData = [
        { y: 53_112, label: "Doctoral degree", indexLabel: '$53,112' },
        { y: 48_468, label: "Master's degree", indexLabel: '$48,468' },
        { y: 32_568, label: "Bachelor's degree", indexLabel: '$32,568' },
        { y: 25_608, label: "Associates degree", indexLabel: '$25,608' },
        { y: 17_976, label: "Undergraduate certificate", indexLabel: '$17,976' },
      ];

      const urlParams = new URLSearchParams(window.location.search);

      const format = urlParams.get('format');
      const formatter = format === 'currency' ? Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format :
        format === 'percent' ? Intl.NumberFormat('en-US', { style: 'percent', maximumFractionDigits: 1, minimumFractionDigits: 0 }).format :
          Intl.NumberFormat('en-US').format;

      const urlData = urlParams.get('data');
      const dataPoints = urlData === null ? defaultData : urlData.split(',').map((dataPoint) => {
        const [label, y] = dataPoint.split(':');
        return { label, y: parseFloat(y), indexLabel: formatter(parseFloat(y)) };
      });

      const chart = new ApexCharts(document.querySelector('#chartContainer'), {
        chart: {
          type: 'bar',
          height: '90%',
          width: '90%',
          toolbar: {
            show: false
          }
        },
        plotOptions: {
          bar: {
            horizontal: true,
            dataLabels: {
              position: 'top'
            },
            barHeight: '60%'
          }
        },
        series: [{
          name: 'Series',
          data: dataPoints.map(({ label, y }) => ({ x: label, y }))
        }],
        colors: ['#5DA6B0'],
        xaxis: {
          labels: {
            show: format === 'percent',
            formatter
          },
          max: format === 'percent' ? 1 : dataPoints.reduce((max, next) => Math.max(max, next.y), 0) * 1.1,
          min: 0,
          tickAmount: format === 'percent' ? 5 : undefined,
          axisTicks: {
            show: false
          }
        },
        grid: {
          yaxis: {
            lines: {
              show: false
            }
          },
          xaxis: {
            lines: {
              show: format === 'percent'
            }
          }
        },
        tooltip: {
          enabled: false
        },
        dataLabels: {
          formatter,
          style: {
            colors: ['#222'],
            fontWeight: null
          },
          textAnchor: 'end',
          offsetX: 10
        },
        fill: {
          opacity: 1
        }

        // data: [{
        //   type: "bar",
        //   color: "#5DA6B0",
        //   dataPoints,
        //   indexLabelPlacement: 'inside',
        //   indexLabelTextAlign: 'right'
        // }],

        // axisX: {
        //   tickLength: 0,
        //   labelMaxWidth: 200,
        //   lineColor: '#ddd',
        // },

        // axisY: {
        //   minimum: 0,
        //   gridThickness: format === 'percent' ? 1 : 0,
        //   gridColor: '#ddd',
        //   labelFormatter: format === 'percent' ? label => formatter(label.value) : () => '',
        //   lineThickness: 0,
        //   tickLength: 0
        // },

        // dataPointWidth: 20,

        // toolTip: {
        //   enabled: false
        // }
      });
      chart.render();
    }</script>
</body>

</html>